(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2037],{87443:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/services/checkout",function(){return t(13898)}])},23642:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});var s=t(85893),a=t(67294),r=t(9473),c=t(96246),l=t(49486);function o(e){let{setStripePromise:n}=e,t=(0,r.v9)(e=>e.auth.stripePublishableKey);return(0,a.useEffect)(()=>{t&&((0,l.qu)(!1,"stripePublishableKey"),n((0,c.J)(t)))},[t]),(0,s.jsx)("p",{hidden:!0,children:"Load Stripe"})}},13898:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return h}});var s=t(85893),a=t(67294),r=t(9473),c=t(11163),l=t(10682),o=t(34051),i=t(31555),u=t(35005);t(86664);var p=t(31243);t(23642);var d=t(43385),f=t(17384),g=t(49486);function h(){let e=(0,c.useRouter)(),n=(0,r.I0)(),[t,h]=(0,a.useState)(null),[w,b]=(0,a.useState)(null),[m,k]=(0,a.useState)(null),[x,v]=(0,a.useState)(!1),S=(0,r.v9)(e=>e.auth.isLoggedIn),j=(0,r.v9)(e=>e.auth.memberId);(0,r.v9)(e=>e.account.stripeClientSecret);let I=(0,r.v9)(e=>e.account.appleClientSecret),A=(0,r.v9)(e=>e.account.checkoutItem),y=(0,r.v9)(e=>e.account.invoice),T=(0,r.v9)(e=>e.account.checkoutPlan),E=y&&y.planOptions,N=E&&E[T].planId;(0,g.qu)(!0,"isLoggedIn: ".concat(S,", checkoutPlan: ").concat(T));let C=e=>{(0,g.qu)(!0,"savePendingAppleTransaction - "),b(e);let n=localStorage.getItem("pendingAppleTransactions");(n=n?JSON.parse(n):{})[j]=e,n=JSON.stringify(n),localStorage.setItem("pendingAppleTransactions",n)},P=()=>{(0,g.qu)(!0,"clearPendingApppleTransaction - "),b(null);let e=localStorage.getItem("pendingAppleTransactions");(e=e?JSON.parse(e):{})[j]=null,e=JSON.stringify(e),localStorage.setItem("pendingAppleTransactions",e)},_=e=>{"ok"===e.status?(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.toggleMessageHandler&&window.webkit.messageHandlers.toggleMessageHandler.postMessage({action:"finishTransaction"}),P(),v(!0)):(console.log("reportAnAppleTransactionCallback returns error, pending: ",w),k(e.error))},q=t=>{(0,g.qu)(!0,"transactionWebCall",t);let s=t.transaction;"ok"===t.status?C(s):e.push("/services/payment"),n((0,f.Xz)(d.op.IOSInAppPurchase))};return(0,a.useEffect)(()=>{S&&T&&((0,g.qu)(!0,"createApplePaymentIntentThunk"),n((0,f.fM)({checkoutPlan:T})))},[S,T]),(0,a.useEffect)(()=>{w&&((0,g.qu)(!0,"useEffect - pendingAppleTransaction: ",w),n((0,f.cK)({transaction:w,callback:_})))},[w]),(0,a.useEffect)(()=>{m&&(0,g.qu)(!0,"useEffect - reportAnAppleTransactionErrorn: ",m)},[m]),(0,a.useEffect)(()=>{(0,g.qu)(!0,"appleCientSecret: ",I),I&&(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.toggleMessageHandler&&(console.log("checkout"),n((0,f.z8)(d.op.IOSInAppPurchase)),window.bsafesNative.transactionWebCall=q,window.webkit.messageHandlers.toggleMessageHandler.postMessage({action:"checkout",planId:N,appleClientSecret:I})),n((0,f.GY)()))},[I]),(0,a.useEffect)(()=>{x&&((0,g.qu)(!0,"Apple transaction is completed."),e.push("/services/appleTransactionCompletion"))},[x]),(0,s.jsxs)(p.Z,{showNaveBar:!1,children:[(0,s.jsxs)(l.Z,{children:[(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)(o.Z,{children:(0,s.jsx)(i.Z,{xs:{span:12},sm:{span:10,offset:1},md:{span:8,offset:2},lg:{span:6,offset:3},children:(0,s.jsx)("div",{style:{borderStyle:"solid"},className:"p-3",children:A&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"Total Amount:"}),(0,s.jsx)("h4",{children:"$".concat((A.amount/100).toFixed(2)," ").concat(A.currency.toUpperCase())})]})})})}),!1,(0,s.jsx)("br",{}),m&&!m.startsWith("Invalid transaction")&&(0,s.jsx)(o.Z,{children:(0,s.jsxs)(i.Z,{xs:{span:12},sm:{span:10,offset:1},md:{span:8,offset:2},lg:{span:6,offset:3},children:["Many thanks for your purchase. We're sorry we failed to complete it due to a"," ",(0,s.jsx)("span",{style:{fontWeight:"bold"},children:m}),". ","Please try again, and you will not be re-charged.",(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)(u.Z,{onClick:()=>{k(null),n((0,f.cK)({transaction:w,callback:_}))},children:"Fix It"})})]})})]}),!1]})}}},function(e){e.O(0,[6760,5339,1243,9774,2888,179],function(){return e(e.s=87443)}),_N_E=e.O()}]);